<div>
  <app-dashboard-top-nav></app-dashboard-top-nav>
</div>
<div class="MainContentDiv">
  <div *ngIf="!IsAddNewClicked" class="w-100">
    <div class="ComponentTop">
      <div class="ComponentTopHeader">
        <h5>Exam Management</h5>
        <p>Total {{ SyllabusCount }} Exams Added</p>
      </div>
       <div class="ComponentTopBottom">
        <button *ngIf="canAdd()" (click)="AddNewClicked()"><mat-icon>add_circle</mat-icon>Set Exam</button>
      </div>
    </div>
    <div class="ComponentRecords">
      <div>
        <div class="ComponentRecordsTop">
          <div class="filterOptions">
            <div class="searchreview input-container" >
              <input type="text" id="searchQuery" class="form-control floating-input"
                [(ngModel)]="searchQuery" (ngModelChange)="onSearchChange()" placeholder="Search... "  />
              <mat-icon style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); pointer-events: none;">search</mat-icon>
              <!-- <i class="fas fa-search" style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); pointer-events: none;"></i> -->
            </div>
            <div class="searchreview" *ngIf="isAdmin && SyllabusList.length != 0">
              <select (change)="onSchoolChange($event)" class="form-control" style="font-size: 11px;">
                <option value="">-- Select School --</option>
                <option value="0">All Schools</option>
                <option *ngFor="let school of schoolList" [value]="school.ID">
                  {{ school.Name }}
                </option>
              </select>
            </div>
          </div>
          <!-- <div class="DownloadButtons" *ngIf="SyllabusList.length != 0">
            <button class="btnHover" (click)="exportSyllabus('pdf')"><mat-icon>picture_as_pdf</mat-icon></button>
            <button class="btnHover" (click)="exportSyllabus('excel')"><mat-icon>description</mat-icon></button>
            <button class="btnHover" (click)="exportSyllabus('print')"><mat-icon>print</mat-icon></button>
          </div> -->
        </div>
        <div class="reviewstable">
          <table id="classTable" *ngIf="SyllabusList.length != 0" class="table table-bordered">
            <thead>
              <tr>
                <th class="visually-hidden">Academic Year ID</th>
                <th>SI.No</th>
                <th>Exam Name</th>
                <th (click)="sort('ExamTypeName')" class="sortable-column">
                  <span class="column-text">Subjects</span>
                  <span class="arrows">
                    <mat-icon 
                      [style.color]="sortColumn === 'ExamTypeName' && sortDirection === 'asc' ? 'red' : 'inherit'">
                      keyboard_arrow_up
                    </mat-icon>
                    <mat-icon 
                      [style.color]="sortColumn === 'ExamTypeName' && sortDirection === 'desc' ? 'red' : 'inherit'">
                      keyboard_arrow_down
                    </mat-icon>
                  </span>
                </th>
                <th *ngIf="isAdmin">School Name</th>
                <th *ngIf="isAdmin">Academic Year</th>
                <th>Max Marks</th>
                <th>Pass Marks</th>               
                <th>ExamDateAndTime</th>               
                <th>Duration</th>               
                <th>Status</th>               
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let Syllabus of SyllabusList,let i = index">
                <td data-label="ID" class="visually-hidden">{{ Syllabus.ID }}</td>
                <td data-label="SI.No">{{ (currentPage - 1) * pageSize + i + 1 }}</td>
                <td data-label="ExamType">{{ Syllabus.ExamType }}</td>
                <td data-label="Subjects">{{ Syllabus.Subjects }}</td>
                <td data-label="ExamType" *ngIf="isAdmin">{{ Syllabus.SchoolName }}</td>
                <td data-label="AcademicYearName" *ngIf="isAdmin">{{ Syllabus.AcademicYearName }}</td>
                <td data-label="MaxMark">{{ Syllabus.MaxMarks }}</td>
                <td data-label="PassMarks">{{ Syllabus.PassMarks }}</td>
                <td data-label="ExamDateAndTime">{{ Syllabus.ExamDateAndTime }}</td>
                <td data-label="Duration">{{ Syllabus.Duration }}</td>
                <td data-label="Status">{{ Syllabus.IsActive }}</td>
                <td data-label="Actions">
                  <div class="d-flex justify-content-center align-items-center h-100">
                    <!-- (click)="editreview(aminitie.propertyTypeID)" -->
                    <button *ngIf="canEdit()" class="btn checkbtn edit" data-tooltip="Edit" (click)="editreview(Syllabus.ID)">
                      <mat-icon class="mat-edit-icon">edit</mat-icon>
                    </button>
                    <button *ngIf="canView()" class="btn checkbtn" data-tooltip="View" (click)="viewReview(Syllabus.ID)">
                      <mat-icon class="mat-edit-icon">visibility</mat-icon>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="SyllabusList.length === 0" class="NoDataFound">
            <div class="NoDataFoundImg">
              <img class="h-100 w-100" src="Images/NoDataFound.jpg" alt="">
            </div>
            <p>No data found.</p>
          </div>
          <div *ngIf="SyllabusCount > pageSize" class="pagination-controls">
            <button *ngIf="totalPages() > 3" (click)="goToPage(1)" [disabled]="currentPage === 1" class="arrow-btn FirstandLastButton">First</button>
            <button (click)="previousPage()" [disabled]="currentPage === 1" class="arrow-btn">←</button>
            <button *ngFor="let page of getVisiblePageNumbers()"
                    class="page-btn"
                    [ngClass]="{'active': page === currentPage}"
                    (click)="goToPage(page)">
              {{ page }}
            </button>
            <button (click)="nextPage()" [disabled]="currentPage === totalPages()" class="arrow-btn">→</button>
            <button *ngIf="totalPages() > 3" (click)="goToPage(totalPages())" [disabled]="currentPage === totalPages()" class="arrow-btn FirstandLastButton">Last</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="IsAddNewClicked" class="w-100">
    <div class="AddForm">
      <div class="AddFormTop">
        <button (click)="AddNewClicked()" title="Back"><mat-icon>arrow_circle_left</mat-icon></button> 
         <p>Set Exam</p>
      </div>
      <div class="AddFormConatiner">
        <form [formGroup]="SyllabusForm">
          <div class="FormInputRowsContainer">
            <div class="InputRow">
               <div class="InputFieldsContainer" *ngIf="isAdmin">
                <label class="inputLabel" for="email">School <span class="required">*</span></label>
                <div class="input-with-error">
                  <select class="inputField" type="date" formControlName="School" placeholder="Select Start Date" (change)="onAdminSchoolChange($event)" >
                    <option value="0">-- Select School --</option>
                    <option *ngFor="let school of schoolList" value="{{school.ID}}">{{school.Name}}</option>
                  </select>
                  <div *ngIf="SyllabusForm.get('School')?.hasError('min') && (SyllabusForm.get('School')?.touched || SyllabusForm.get('School')?.dirty)" class="text-danger">
                      <small>Please Select School.</small>
                  </div>
                </div>
              </div> 
             
               <div class="InputFieldsContainer">
                <label class="inputLabel" for="email">ExamType<span class="required">*</span></label>
                <div class="input-with-error">
                  <select class="inputField" type="date" formControlName="ExamType" placeholder="Select Start Date"   >
                    <option value="0">-- Select Exam --</option>
                    <option *ngFor="let school of examLists" value="{{school.ID}}">{{school.Name}}</option>
                  </select>
                  <div *ngIf="SyllabusForm.get('ExamType')?.hasError('min') && (SyllabusForm.get('ExamType')?.touched || SyllabusForm.get('ExamType')?.dirty)" class="text-danger">
                      <small>Please Select ExamType.</small>
                  </div>
                </div>
              </div>

            </div>
            <div class="InputRow">
               <div class="InputFieldsContainer">
                <label class="inputLabel" for="email">Academic Year <span class="required">*</span></label>
                <div class="input-with-error">
                  <select class="inputField" type="date" formControlName="AcademicYear" placeholder="Select Start Date" (change)="onAdminAcademicYearchange($event)">
                    <option value="0">-- Select Academic Year --</option>
                    <option *ngFor="let school of academicYearList" value="{{school.ID}}">{{school.Name}}</option>
                  </select>
                  <div *ngIf="SyllabusForm.get('AcademicYear')?.hasError('min') && (SyllabusForm.get('AcademicYear')?.touched || SyllabusForm.get('AcademicYear')?.dirty)" class="text-danger">
                      <small>Please Select Academic Year.</small>
                  </div>
                </div>
              </div>
               <div class="InputFieldsContainer">
                <label class="inputLabel" for="email">Class<span class="required">*</span></label>
                <div class="input-with-error">
                  <select class="inputField" type="date" formControlName="Class" placeholder="Select Start Class" (change)="onAdminClasschange($event)">
                    <option value="0">-- Select Class--</option>
                    <option *ngFor="let school of classLists" value="{{school.ID}}">{{school.Name}}</option>
                  </select>
                  <div *ngIf="SyllabusForm.get('Class')?.hasError('min') && (SyllabusForm.get('Class')?.touched || SyllabusForm.get('Class')?.dirty)" class="text-danger">
                      <small>Please Select Class.</small>
                  </div>
                </div>
              </div>
             
                <!-- <div class="InputFieldsContainer" *ngIf="isAdmin">
                <label class="inputLabel" for="email">Class <span class="required">*</span></label>
                <div class="custom-multiselect">
                  <div class="select-box" (click)="classDropdownOpen = !classDropdownOpen">
                    {{ selectedClasses.length ? selectedClasses.length + ' selected' : 'Select Class' }}
                    <span class="arrow">{{ classDropdownOpen ? '▲' : '▼' }}</span>
                  </div>
                  <div class="options" *ngIf="classDropdownOpen">
                    <label *ngFor="let cat of classLists">
                      <input type="checkbox"
                            [checked]="selectedClasses.includes(cat.ID)"
                            (change)="toggleClassSelection(cat.ID)">
                      {{cat.Name}}
                    </label>
                  </div>
                </div>
                <div *ngIf="(SyllabusForm.get('Class')?.touched && SyllabusForm.get('Class')?.invalid)" class="text-danger">
                    <div *ngIf="(SyllabusForm.get('Class')?.errors?.['required'])">
                      <small>Please Select Class.</small>
                    </div>
                  </div>
              </div> -->
              
                 </div>
                   <div class="InputRow">
              <div class="InputFieldsContainer">
                <div class="toggle-container" (click)="$event.stopPropagation()">
                  <label class="switch">
                    <input type="checkbox" [checked]="IsActiveStatus" [disabled]="!canDelete()" (click)="toggleChange()">
                    <span class="slider">
                      <span
                        class="toggle-text"
                        [ngStyle]="{
                          left: IsActiveStatus ? '42%' : '60%',
                          fontSize: IsActiveStatus ? '9px' : '9px'
                        }"
                      >
                        {{ IsActiveStatus ? 'Active' : 'Inactive' }}
                      </span>
                    </span>
                  </label>
                </div>
              </div>
            </div>
             
             </div>
     
       <div class="ActionButtons">
<button type="button"
        class="btn"
        (click)="GenerateModalTable()"
        [disabled]="SyllabusForm.invalid || subjectsLists.length === 0">
  Next
</button>       
        </div>
        </form>
      </div>
    </div>
  </div>
  </div>


<!-- === Inline table section (no modal classes) === -->
<div *ngIf="isTableModalOpen  && IsAddNewClicked" class="w-100 mt-4 inline-table-section">
  <div class="AddForm">  <!-- ← reuse same wrapper for consistent look -->
    <div class="AddFormTop">
      <h5>Set Exam</h5>
    </div>
    
    <div class="AddFormConatiner">
      <div class="table-responsive">  <!-- makes table scrollable on small screens -->
        <table class="table table-bordered table-sm">
          <thead class="table-light">
            <tr>
              <th>Status</th>
              <th>Subject</th>
              <th>Divisions</th>
              <th>Max Marks</th>
              <th>Pass Marks</th>
              <th>Exam Date & Time</th>
              <th>Duration</th>
              <th>No of Questions</th>
              <th>Instructions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of tableRows; let i = index">
           <td>
  <div class="InputFieldsContainer">
    <div class="toggle-container">
      <label class="switch">
        <input type="checkbox" [(ngModel)]="tableRows[i].isActive">
        <!-- <input type="checkbox"
       [(ngModel)]="tableRows[i].isActive"
       (change)="onSubjectToggle(i)"> --> <!--for this function is in ts "onSubjectToggle"-->
        <span class="slider round">
          <span
            class="toggle-text"
            [ngStyle]="{
              left: tableRows[i].isActive ? '42%' : '60%',
              fontSize: '1px'
            }"
          >
            {{ tableRows[i].isActive ? 'Active' : 'Inactive' }}
          </span>
        </span>
      </label>
    </div>
  </div>
</td>
              <td>{{ row.subjectName }}</td>
              <td>
                <div class="custom-multiselect">
                  <div class="select-box" (click)="toggleDivisionDropdown(i)">
                    {{ tableRows[i].selectedDivisions.length ? tableRows[i].selectedDivisions.length + ' selected' : 'Division' }}
                    <span class="arrow">{{ tableRows[i].divisionDropdownOpen ? '▲' : '▼' }}</span>
                  </div>
                  <div class="options" *ngIf="tableRows[i].divisionDropdownOpen">
                    <label *ngFor="let div of row.divisions">
                      <input type="checkbox"
                             [checked]="tableRows[i].selectedDivisions.includes(div.ID)"
                             (change)="toggleDivisionSelection(i, div.ID)">
                      {{ div.Name }}
                    </label>
                  </div>
                </div>
              </td>
              <td><input type="number" min="0" [(ngModel)]="tableRows[i].maxMarks" class="form-control form-control-sm" readonly  /></td>
              <td><input type="number" min="0" [(ngModel)]="tableRows[i].passMarks" class="form-control form-control-sm" readonly/></td>
              <td><input type="datetime-local" [(ngModel)]="tableRows[i].examDateAndTime" class="form-control form-control-sm" /></td>
              <td><input type="text" [(ngModel)]="tableRows[i].duration" placeholder="e.g. 2h 30m" class="form-control form-control-sm" readonly/></td>
              <td><input type="number" min="1" [(ngModel)]="tableRows[i].noOfQuestions" class="form-control form-control-sm" readonly/></td>
              <td><input type="text" [(ngModel)]="tableRows[i].instructions" class="form-control form-control-sm" readonly/></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="ActionButtons mt-3">
        <button type="button" class="btn btn-secondary" (click)="isTableModalOpen  = false">
          Cancel
        </button>
       <button type="button" class="btn btn-primary" (click)="saveExam()">
  {{ SyllabusForm.get('ID')?.value ? 'Update' : 'Submit' }}
</button>
      </div>
    </div>
  </div>
  </div>
  
  <div class="modal" tabindex="-1" role="dialog" [ngClass]="{'show': isStatusModalOpen}" [style.display]="isStatusModalOpen ? 'block' : 'none'">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Application Status</h5>
        <button type="button" class="close" aria-label="Close" (click)="closeModal('status')">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>{{ AminityInsStatus }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="handleOk()">OK</button>
      </div>
    </div>
  </div>
</div>
<div class="modal" tabindex="-1" role="dialog" [ngClass]="{'show': isViewModalOpen}" [style.display]="isViewModalOpen ? 'block' : 'none'">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
       <div class="modal-header">
        <h5 class="modal-title">Set Exam Details</h5>
        <button type="button" class="close" (click)="closeModal('view')">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row mb-2">
          <div class="col-4">ExamName</div>
          <div class="col-8">{{ viewSyllabus?.ExamType }}</div>
        </div>

        <div class="row mb-2">
          <div class="col-4">Class</div>
          <div class="col-8">{{ viewSyllabus?.Class }}</div>
        </div>

         <div class="row mb-2">
          <div class="col-4">Subject</div>
          <div class="col-8">{{ viewSyllabus?.Subjects }}</div>
        </div>

        <div class="row mb-2">
          <div class="col-4">Divisions</div>
          <div class="col-8">{{ viewSyllabus?.Divisions }}</div>
        </div>

         <div class="row mb-2">
          <div class="col-4">PassMarks</div>
          <div class="col-8">{{ viewSyllabus?.PassMarks }}</div>
        </div>

         <div class="row mb-2">
          <div class="col-4">ExamDateAndTime</div>
          <div class="col-8">{{ viewSyllabus?.ExamDateAndTime }}</div>
        </div>

        <div class="row mb-2">
          <div class="col-4">ExamDuration</div>
          <div class="col-8">{{ viewSyllabus?.Duration }}</div>
        </div>

        <div class="row mb-2">
          <div class="col-4">NoofQuestion</div>
          <div class="col-8">{{ viewSyllabus?.NoOfQuestion }}</div>
        </div>

        <div class="row mb-2">
          <div class="col-4">Instructions</div>
          <div class="col-8">{{ viewSyllabus?.Instructions }}</div>
        </div>

        <div class="row mb-2" *ngIf="viewSyllabus?.SchoolName">
          <div class="col-4">School Name</div>
          <div class="col-8 viewfontsize">{{ viewSyllabus?.SchoolName }}</div>
        </div>

        
        <div class="row mb-2" *ngIf="viewSyllabus?.AcademicYearName">
          <div class="col-4">Academic Year</div>
          <div class="col-8 viewfontsize">{{ viewSyllabus?.AcademicYearName }}</div>
        </div>
    
        <div class="row mb-2">
          <div class="col-4">Status</div>
          <div class="col-8">
            <span class="badge"
                  [ngClass]="viewSyllabus?.IsActive ? 'badge-success' : 'badge-danger'">
              {{ viewSyllabus?.IsActive ? 'Active' : 'Inactive' }}
            </span>
          </div>
        </div>
      </div>
      <!-- <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">Close</button>
      </div> -->
    </div>
  </div>
